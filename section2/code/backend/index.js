// index.js
const express = require("express");
const cors = require("cors");
// à¸™à¸³à¹€à¸‚à¹‰à¸² User Router à¸ˆà¸²à¸à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ routes
const userRoutes = require("./routes/users");

const app = express();
const PORT = 5000;

// ========================
// 1. à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ Middleware
// ========================
app.use(express.json()); // à¸ªà¸³à¸„à¸±à¸! à¸—à¸³à¹ƒà¸«à¹‰ Express à¸­à¹ˆà¸²à¸™à¸à¹‰à¸­à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸šà¸š JSON à¸­à¸­à¸
app.use(cors()); // à¸ªà¸³à¸„à¸±à¸! à¸¢à¸­à¸¡à¹ƒà¸«à¹‰ React (à¸žà¸­à¸£à¹Œà¸• 5173) à¹€à¸£à¸µà¸¢à¸à¹€à¸‚à¹‰à¸²à¸¡à¸²à¹„à¸”à¹‰

// à¸ªà¸£à¹‰à¸²à¸‡ Logger Middleware à¸›à¸£à¸°à¸à¸²à¸¨à¹„à¸§à¹‰ "à¸à¹ˆà¸­à¸™" à¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¸‡à¸¡à¸²à¸–à¸¶à¸‡ Route
const requestLogger = (req, res, next) => {
  console.log(
    `[${new Date().toLocaleTimeString()}] à¸¡à¸µà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸ ${req.method} à¸—à¸µà¹ˆ ${req.url}`
  );
  next(); // âš ï¸ à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸! à¸•à¹‰à¸­à¸‡à¹€à¸£à¸µà¸¢à¸ next() à¹€à¸žà¸·à¹ˆà¸­à¸šà¸­à¸à¸›à¸£à¸°à¸•à¸¹à¸”à¹ˆà¸²à¸™à¸–à¸±à¸”à¹„à¸›à¸§à¹ˆà¸² "à¸œà¹ˆà¸²à¸™à¹„à¸”à¹‰"
};

app.use(requestLogger);

// ========================
// 2. à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ Routes (à¸—à¸µà¹ˆà¹à¸¢à¸à¹„à¸Ÿà¸¥à¹Œà¹„à¸§à¹‰)
// ========================

// à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸—à¸”à¸ªà¸­à¸š
app.get("/", (req, res) => {
  res.send("Hello World! Backend à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§ ðŸŽ‰");
});


// à¸šà¸­à¸ Express à¸§à¹ˆà¸² "à¸–à¹‰à¸²à¸¡à¸µà¹ƒà¸„à¸£à¹€à¸£à¸µà¸¢à¸à¸‚à¸¶à¹‰à¸™à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ /api/users à¹ƒà¸«à¹‰à¸§à¸´à¹ˆà¸‡à¹„à¸›à¸”à¸¹à¹„à¸Ÿà¸¥à¹Œ userRoutes à¹à¸—à¸™à¸™à¸°"
app.use("/api/users", userRoutes);

// ========================
// 3. à¸ªà¸±à¹ˆà¸‡à¹ƒà¸«à¹‰ Server à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‡à¸²à¸™
// ========================
app.listen(PORT, () => {
  console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);
});